<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CaveTown Explorer</title>
    <style>
        :root {
            --bg-color: #0d0d12;
            --wall-color: #2a2a35;
            --floor-color: #1a1a2e;
            --accent-color: #00f2ff;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: white;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
        }

        .container {
            position: relative;
            padding: 2rem;
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            max-width: 90vw;
        }

        h1 {
            margin: 0;
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #fff 0%, var(--accent-color) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            letter-spacing: -0.02em;
        }

        canvas {
            border-radius: 12px;
            background: #000;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8), 0 0 30px rgba(0, 242, 255, 0.1);
            image-rendering: pixelated;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            background: var(--glass-bg);
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .status {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.5);
            text-align: center;
        }

        .glow {
            position: absolute;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(0, 242, 255, 0.15) 0%, transparent 70%);
            pointer-events: none;
            z-index: -1;
            filter: blur(40px);
        }
    </style>
</head>

<body>
    <div class="glow" style="top: 10%; left: 20%;"></div>
    <div class="glow" style="bottom: 10%; right: 20%;"></div>

    <div class="container">
        <h1>CaveTown Visualizer</h1>
        <canvas id="caveCanvas"></canvas>
        <div class="status" id="status">Loading cave data...</div>
        <div class="controls">
            <button class="btn" onclick="render()">Refresh View</button>
            <button class="btn" onclick="toggleMode()">Toggle Style</button>
        </div>
    </div>

    <script id="caveDataScript"></script>
    <script>
        const canvas = document.getElementById('caveCanvas');
        const ctx = canvas.getContext('2d');
        let caveWidth = 0;
        let caveHeight = 0;
        let grid = [];
        let style = 'neon';

        async function loadData() {
            if (window.CAVE_DATA) {
                caveWidth = window.CAVE_DATA.width;
                caveHeight = window.CAVE_DATA.height;
                grid = window.CAVE_DATA.grid;
                document.getElementById('status').innerText = `Generated ${caveWidth}x${caveHeight} Cave System`;
                render();
                return;
            }
            // Fallback to fetch if needed
            try {
                const response = await fetch('../../cave_data.json');
                const data = await response.json();
                caveWidth = data.width;
                caveHeight = data.height;
                grid = data.grid;

                document.getElementById('status').innerText = `Generated ${caveWidth}x${caveHeight} Cave System`;
                render();
            } catch (e) {
                document.getElementById('status').innerText = "Error: Use a local server to view (e.g., 'python -m http.server')";
                console.error(e);
            }
        }

        function render() {
            if (!grid.length) return;

            const cellSize = 16;
            canvas.width = caveWidth * cellSize;
            canvas.height = caveHeight * cellSize;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let y = 0; y < caveHeight; y++) {
                for (let x = 0; x < caveWidth; x++) {
                    const val = grid[y][x];
                    const cx = x * cellSize;
                    const cy = y * cellSize;

                    if (val === 1) {
                        // Wall
                        if (style === 'neon') {
                            ctx.fillStyle = '#2a2a35';
                            ctx.fillRect(cx, cy, cellSize, cellSize);
                            ctx.strokeStyle = '#00f2ff22';
                            ctx.strokeRect(cx, cy, cellSize, cellSize);

                            // Highlight edges
                            if (isEdge(x, y)) {
                                ctx.shadowBlur = 10;
                                ctx.shadowColor = '#00f2ff';
                                ctx.strokeStyle = '#00f2ff44';
                                ctx.strokeRect(cx + 1, cy + 1, cellSize - 2, cellSize - 2);
                                ctx.shadowBlur = 0;
                            }
                        } else {
                            ctx.fillStyle = '#111';
                            ctx.fillRect(cx, cy, cellSize, cellSize);
                        }
                    } else {
                        // Floor
                        ctx.fillStyle = style === 'neon' ? '#1a1a2e' : '#222';
                        ctx.fillRect(cx, cy, cellSize, cellSize);

                        // Subtle texture
                        ctx.fillStyle = 'rgba(255,255,255,0.02)';
                        if ((x + y) % 3 === 0) ctx.fillRect(cx + 4, cy + 4, 2, 2);
                    }
                }
            }
        }

        function isEdge(x, y) {
            for (let dy = -1; dy <= 1; dy++) {
                for (let dx = -1; dx <= 1; dx++) {
                    const nx = x + dx;
                    const ny = y + dy;
                    if (nx >= 0 && nx < caveWidth && ny >= 0 && ny < caveHeight) {
                        if (grid[ny][nx] === 0) return true;
                    }
                }
            }
            return false;
        }

        function toggleMode() {
            style = style === 'neon' ? 'classic' : 'neon';
            render();
        }

        loadData();
    </script>
</body>

</html>